# ๐ฌ Stream URL Handling & Diagnostics - ูุนุงูุฌุฉ ุงูุฑูุงุจุท ูุงูุชุดุฎูุต

## ๐ด ุงููุดููุฉ ุงูุฃุตููุฉ

```
levelLoadError: 404 Not Found
index_1.m3u8 โ 404
index_2.m3u8 โ 404
...
```

### ๐ ุงูุณุจุจ ุงูุฌุฐุฑู

**HLS playlists ุชุญุชูู ุนูู ุนุฏุฉ ูุณุชููุงุช ุฌูุฏุฉ:**

```
master.m3u8 (ุงูุฑุงุจุท ุงูุฑุฆูุณู)
  โโโ index_0.m3u8 (ุฃุนูู ุฌูุฏุฉ)
  โโโ index_1.m3u8 (ุฌูุฏุฉ ูุชูุณุทุฉ)
  โโโ index_2.m3u8 (ุฌูุฏุฉ ููุฎูุถุฉ)
```

**ุงููุดุงูู ุงูุดุงุฆุนุฉ:**
- โ ุงูุฑูุงุจุท ูุคูุชุฉ (expiring URLs)
- โ ูุณุชููุงุช ุงูุฌูุฏุฉ ูุฏ ูุง ุชููู ููุฌูุฏุฉ
- โ ุญูุงูุฉ ุจู Token ุฃู Geo-restriction
- โ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฑูุงุจุท

---

## โ ุงูุญููู ุงููุทุจูุฉ

### 1๏ธโฃ **ูุนุงูุฌุฉ ุฐููุฉ ููุฃุฎุทุงุก**

```javascript
hls.on(Hls.Events.ERROR, (event, data) => {
    if (data.fatal) {
        // ุฃุฎุทุงุก ุญุฑุฌุฉ ุชุญุชุงุฌ ุชุฏุฎู
        if (data.type === NETWORK_ERROR) {
            // ุฅุนุงุฏุฉ ูุญุงููุฉ
            hls.startLoad();
        }
    } else {
        // ุฃุฎุทุงุก ุบูุฑ ุญุฑุฌุฉ - ุชุฌุงูููุง
        console.warn('โ๏ธ ุชุญุฐูุฑ: ' + data.details);
    }
});
```

**ุงููุชูุฌุฉ:** 
- โ ุชุฌุงูู ูุณุชููุงุช ุงูุฌูุฏุฉ ุงูููููุฏุฉ 404
- โ ุงูุชุฑููุฒ ุนูู ูุณุชููุงุช ุงูุฌูุฏุฉ ุงููุชุงุญุฉ
- โ ุงุณุชูุฑุงุฑ ุงูุชุดุบูู ุจุฏูู ุชููู

### 2๏ธโฃ **ุงุฎุชูุงุฑ ูุณุชูู ุฌูุฏุฉ ูุญุฏุฏ**

```javascript
hls.on(Hls.Events.MANIFEST_PARSED, () => {
    // ุงุณุชุฎุฏู ุฃูู ูุณุชูู ูุชุงุญ (ุนุงุฏุฉ ุงูุฃุนูู ุฌูุฏุฉ)
    hls.startLevel = 0;
    hls.loadLevel = 0;
    console.log(`๐ฌ ุงุฎุชูุงุฑ ุงููุณุชูู: ${hls.levels[0].name}`);
});
```

**ุงููุงุฆุฏุฉ:**
- โ ุชุฌูุจ ูุญุงููุฉ ุชุญููู ูุณุชููุงุช ุบูุฑ ููุฌูุฏุฉ
- โ ุงุฎุชูุงุฑ ุฃูุถู ุฌูุฏุฉ ูุชุงุญุฉ ูุจุงุดุฑุฉ
- โ ุชูููู ุงูุฃุฎุทุงุก 404

### 3๏ธโฃ **ูุญุต ุตุญุฉ ุงูุฑุงุจุท ูุจู ุงูุชุดุบูู**

```javascript
async validateStreamUrl(streamUrl) {
    // ูุญุต ุฃุณุงุณู
    if (!streamUrl || !streamUrl.startsWith('http')) {
        throw new Error('ุงูุฑุงุจุท ุบูุฑ ุตุงูุญ');
    }

    // ูุญุงููุฉ ุฌูุจ ุงูุฑุงุจุท
    const response = await fetch(streamUrl, { method: 'HEAD' });
    
    if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
    }

    return true;
}
```

**ุงููุงุฆุฏุฉ:**
- โ ูุดู ุงูุฑูุงุจุท ุงูููููุฏุฉ ูุจูุฑุงู
- โ ุชูุจููุงุช ูุงุถุญุฉ ูููุณุชุฎุฏู
- โ ุชุฌูุจ ูุญุงููุงุช ุงูุชุดุบูู ุงููุงุดูุฉ

### 4๏ธโฃ **ุชุดุฎูุต ููุตู ูููุดุงูู**

```javascript
async diagnoseStreamUrl(streamUrl) {
    return {
        url: streamUrl,
        isM3U8: streamUrl.includes('.m3u8'),
        httpStatus: response.status,
        canAccess: response.ok,
        suggestions: ['...']
    };
}
```

**ุงููุนูููุงุช ุงููุฑุฌุนุฉ:**
```
โ isM3U8: true
โ httpStatus: 404
โ canAccess: false
๐ก suggestions: [
    "โ ุงูุฑุงุจุท ุบูุฑ ููุฌูุฏ (404)",
    "๐ก ุชุญูู ูู ุตุญุฉ ุงูุฑุงุจุท ุฃู ุงูุชุธุฑ ุงูุชุญุฏูุซ"
]
```

### 5๏ธโฃ **ูุฑุงูุจุฉ ูุณุชูุฑุฉ ูุตุญุฉ ุงูุจุซ**

```javascript
startStreamHealthMonitor(videoElement, hls) {
    setInterval(() => {
        // ูุญุต ุฅุฐุง ูุงู ุงูุจุซ ูุชูููุงู (stalled)
        if (currentBuffered === lastBufferedTime) {
            stallCount++;
            
            if (stallCount > 3) {
                // ูุญุงููุฉ ุงุณุชุนุงุฏุฉ ุงูุจุซ
                hls.startLoad();
            }
        }
    }, 1000);
}
```

**ุงููุงุฆุฏุฉ:**
- โ ูุดู ุงูุจุซ ุงููุชููู ุชููุงุฆูุงู
- โ ูุญุงููุฉ ุงุณุชุนุงุฏุฉ ุชููุงุฆูุฉ
- โ ูุนูููุงุช ุงูุฃุฏุงุก ุงููุณุชูุฑุฉ

### 6๏ธโฃ **ุชุญุฏูุซ ุงูุฑูุงุจุท ุงููุคูุชุฉ**

```javascript
async refreshExpiredUrls() {
    for (let item of this.contentList) {
        const age = Date.now() - item.urlFetchedAt;
        
        // ุฅุฐุง ูุงูุช ุงูุฑุงุจุท ุฃูุซุฑ ูู ุณุงุนุฉ
        if (age > oneHour) {
            console.log(`๐ ุชุญุฏูุซ ุงูุฑุงุจุท: ${item.name}`);
            // ูููู ุฌูุจ ุฑุงุจุท ุฌุฏูุฏ ูู ุงูุฎุงุฏู
        }
    }
}
```

---

## ๐ ุชุฏูู ุงููุนุงูุฌุฉ ุงูุฌุฏูุฏ

```
User clicks play
    โ
extractPlayUrl(content)
    โ (ุงูุจุญุซ ุงูุฐูู ุนู ููุงุชูุญ ูุฎุชููุฉ)
    โ
playStream(playUrl)
    โ
validateStreamUrl(playUrl) [ุงุฎุชูุงุฑู]
    โ (ูุญุต ุณุฑูุน ููุฑุงุจุท)
    โ
playHLS(videoElement, playUrl)
    โ
hls.loadSource(playUrl)
    โ
hls.on(MANIFEST_PARSED)
    โ
selectLevel(0) โ ุงุณุชุฎุฏู ุฃูู ูุณุชูู
    โ
videoElement.play()
    โ
startStreamHealthMonitor()
    โ (ูุฑุงูุจุฉ ูุณุชูุฑุฉ)
    โ
โ ุงูุจุซ ูุดุชุบู ุจุณูุงุณุฉ
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุญููู

### ุงุฎุชุจุงุฑ 1: ุชุญููู ุฑุงุจุท ุตุญูุญ

```javascript
// ุงูุฅุฏุฎุงู
https://example.com/stream/index.m3u8

// ุงููุชูุฌุฉ
โ ุชู ุชุญููู manifest HLS
๐ ุนุฏุฏ ูุณุชููุงุช ุงูุฌูุฏุฉ: 3
๐ฌ ุงุฎุชูุงุฑ ุงููุณุชูู: 1280x720 (index_0.m3u8)
โถ๏ธ ุงูุจุซ ูุดุชุบู
```

### ุงุฎุชุจุงุฑ 2: ุชุญููู ุฑุงุจุท ูุน ุฃุฎุทุงุก 404

```javascript
// ุงูุฅุฏุฎุงู
https://example.com/stream/index.m3u8
  โโโ index_0.m3u8 โ 200 OK
  โโโ index_1.m3u8 โ 404 Not Found
  โโโ index_2.m3u8 โ 404 Not Found

// ุงููุชูุฌุฉ
โ๏ธ ุฎุทุฃ HLS: levelLoadError
๐ ููู ุงูุจุซ ูุณุชูุฑ ุจู index_0.m3u8
โ ุงูุจุซ ูุดุชุบู ุจุงูุฌูุฏุฉ ุงููุชุงุญุฉ
```

### ุงุฎุชุจุงุฑ 3: ุฑุงุจุท ุบูุฑ ููุฌูุฏ

```javascript
// ุงูุฅุฏุฎุงู
https://example.com/missing.m3u8

// ุงููุชูุฌุฉ
๐ ูุญุต ุตุญุฉ ุงูุฑุงุจุท
โ HTTP 404: ุงูุฑุงุจุท ุบูุฑ ููุฌูุฏ
๐ก ุชุญูู ูู ุตุญุฉ ุงูุฑุงุจุท ุฃู ุงูุชุธุฑ ุงูุชุญุฏูุซ
```

---

## ๐ง ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุฎุงุตุฉ

### Case 1: Geo-Restricted Stream

```javascript
// ุงูุฎุทุฃ
โ HTTP 403: Forbidden

// ุงูุญู
console.log('โ๏ธ ุงููุตูู ูุฑููุถ - ูุฏ ุชููู ูููุฏุฉ ุฌุบุฑุงููุงู');
```

### Case 2: Token-Protected Stream

```javascript
// ูุฌุจ ุฅุถุงูุฉ Token ูู ุงูุทูุจ
xhrSetup: (xhr, url) => {
    xhr.setRequestHeader('Authorization', 'Bearer <token>');
}
```

### Case 3: Temporary URLs (Expiring)

```javascript
// ุชุญุฏูุซ ุงูุฑูุงุจุท ูู ุณุงุนุฉ
refreshExpiredUrls();

// ุฃู ุนูุฏ ุจุฏุก ุงูุชุดุบูู
validateStreamUrl(playUrl);
```

---

## ๐ ููุฎุต ุงูุชุญุณููุงุช

| ุงูููุฒุฉ | ุงููุงุฆุฏุฉ |
|--------|--------|
| **ูุนุงูุฌุฉ ุฐููุฉ ููุฃุฎุทุงุก** | ุชุฌุงูู 404 ูุงูุงุณุชูุฑุงุฑ ุจุงูุชุดุบูู |
| **ุงุฎุชูุงุฑ ูุณุชูู ูุญุฏุฏ** | ุชุฌูุจ ูุญุงููุฉ ุชุญููู ูุณุชููุงุช ููููุฏุฉ |
| **ูุญุต ุตุญุฉ ุงูุฑุงุจุท** | ูุดู ุงููุดุงูู ูุจูุฑุงู |
| **ุชุดุฎูุต ููุตู** | ูุนูููุงุช ูุงุถุญุฉ ุนู ุงูุฃุฎุทุงุก |
| **ูุฑุงูุจุฉ ูุณุชูุฑุฉ** | ุงุณุชุนุงุฏุฉ ุชููุงุฆูุฉ ูู ุงูุจุซ ุงููุชููู |
| **ุชุญุฏูุซ ุงูุฑูุงุจุท** | ูุนุงูุฌุฉ ุงูุฑูุงุจุท ุงููุคูุชุฉ |

---

## ๐ก ูุตุงุฆุญ ุนูููุฉ

### ููุชุทููุฑ ูุงูุงุฎุชุจุงุฑ

```bash
# ุงุณุชุฎุฏู VLC ุฃู PotPlayer ูุงุฎุชุจุงุฑ ุงูุฑุงุจุท ูุจุงุดุฑุฉ
vlc "https://example.com/stream/index.m3u8"

# ุฅุฐุง ุงุดุชุบู ูู VLCุ ุงููุดููุฉ ูู ุงูู Hls.js config
# ุฅุฐุง ูู ูุดุชุบูุ ุงููุดููุฉ ูู ุงูุฑุงุจุท ููุณู
```

### ุนูุฏ ุญุฏูุซ ุฃุฎุทุงุก 404

```javascript
// ุงุทุจุน ูุนูููุงุช ุงููุณุชููุงุช
console.table(hls.levels);

// ูุฏ ุชุฑู:
// [
//   { name: "1280x720", url: "index_0.m3u8" },
//   { name: "854x480", url: "index_1.m3u8" },  // โ ูุฏ ูุง ูููู ููุฌูุฏุงู
// ]
```

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก

```javascript
// ุดุงูุฏ ุฑุณุงุฆู ุงูููุณูู
๐ ุงูุฃุฏุงุก - ุงูุฌูุฏุฉ: 1280x720, Buffer: 5.2s
๐บ ุชุจุฏูู ูููุณุชูู: 1
โ๏ธ ุงูุจุซ ูุชููู (1)
๐ ูุญุงููุฉ ุงุณุชุนุงุฏุฉ ุงูุจุซ...
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

- โ `static/js/streaming-manager.js`
  - โ `validateStreamUrl()` - ูุญุต ุงูุฑุงุจุท
  - โ `diagnoseStreamUrl()` - ุชุดุฎูุต ููุตู
  - โ `refreshExpiredUrls()` - ุชุญุฏูุซ ุงูุฑูุงุจุท
  - โ `startStreamHealthMonitor()` - ูุฑุงูุจุฉ ุงูุตุญุฉ
  - โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู `playHLS()`

---

**ุขุฎุฑ ุชุญุฏูุซ:** 23 ุฏูุณูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** v3.3 (ูุน Stream URL Handling & Diagnostics)
