# ูุธุงู ุงูุจูุงูููุณุชุฑุงุช ุงููุชุนุฏุฏุฉ - ุฏููู ุงูุชุทุจูู

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุฏูุซ ุงููุธุงู ููุณูุญ ูููุณุชุฎุฏููู ุจุฅุถุงูุฉ ูุฅุฏุงุฑุฉ **ุนุฏุฉ ุจูุงูููุณุชุฑุงุช (Playlists)** ุจุฏูุงู ูู ุฑุงุจุท ูุงุญุฏ ููุท.

### ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ:

1. **ุฌุฏูู ุฌุฏูุฏ**: `user_playlists` ูุชุฎุฒูู ุงูุจูุงูููุณุชุฑุงุช ุงููุชุนุฏุฏุฉ
2. **ูุงุฌูุฉ ุฌุฏูุฏุฉ**: ุตูุญุฉ `/playlist` ูุญุณููุฉ ูุฅุฏุงุฑุฉ ุงูุจูุงูููุณุชุฑุงุช
3. **API endpoints ุฌุฏูุฏ**: ูููุณุชุฎุฏููู ูุงูููุฒุนูู
4. **ุฏุนู ุงูููุฒุน**: ุฅููุงููุฉ ุงูููุฒุน ุฅุถุงูุฉ ุจูุงูููุณุชุฑุงุช ููุตู ุจูุง (ุงุฎุชูุงุฑู)

---

## ๐๏ธ ุงูุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู ุฌุฏูุฏ: `user_playlists`

```sql
CREATE TABLE user_playlists (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    device_id INTEGER NOT NULL,
    name VARCHAR(100) NOT NULL,
    media_link TEXT NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    reseller_playlist TEXT NULL,  -- ูุญุชูู ุงูุจูุงูููุณุช ูู ุงูููุฒุน
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (device_id) REFERENCES devices(id)
);
```

### ุงูุนูุงูุงุช:

```
User (1:N) UserPlaylist
Device (1:N) UserPlaylist
```

**ุงูุญููู:**
- `id`: ูุนุฑู ูุฑูุฏ ููุจูุงูููุณุช
- `user_id`: ุงููุณุชุฎุฏู ุงูุฐู ูููู ุงูุจูุงูููุณุช
- `device_id`: ุงูุฌูุงุฒ (ุฑุจุท ุงุฎุชูุงุฑู)
- `name`: ุงุณู ุงูุจูุงูููุณุช (ูุซุงู: "Premium IPTV", "My Sports")
- `media_link`: ุงูุฑุงุจุท ุงููุนูู (M3U, M3U8, Xtream Codes API)
- `is_active`: ูู ุงูุจูุงูููุณุช ููุนูู (True) ุฃู ูุนุทูู (False)
- `reseller_playlist`: ุงูุฑุงุจุท ูู ุงูููุฒุน (ุงุฎุชูุงุฑู - NULL ุฅุฐุง ูุงู ูู ุงููุณุชุฎุฏู)
- `created_at`/`updated_at`: ุชูุงุฑูุฎ ุงูุฅูุดุงุก ูุงูุชุญุฏูุซ

---

## ๐ API Endpoints ุงูุฌุฏูุฏุฉ

### ูููุณุชุฎุฏููู (User)

#### 1. ุฌูุจ ุฌููุน ุงูุจูุงูููุณุชุฑุงุช
```
GET /api/playlists
```

**ุงูุฑุฏ:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "Premium IPTV",
      "media_link": "https://...",
      "is_active": true,
      "created_at": "2025-12-23T12:00:00"
    },
    ...
  ],
  "total": 2
}
```

#### 2. ุฅุถุงูุฉ ุจูุงูููุณุช ุฌุฏูุฏ
```
POST /api/playlists
Content-Type: application/json

{
  "name": "My Sports",
  "media_link": "https://example.com/sports.m3u8"
}
```

**ุงูุฑุฏ:**
```json
{
  "success": true,
  "message": "ุชู ุฅุถุงูุฉ ุงูุจูุงูููุณุช ุจูุฌุงุญ",
  "data": {
    "id": 2,
    "name": "My Sports",
    "media_link": "https://...",
    "is_active": true,
    "created_at": "2025-12-23T12:00:00"
  }
}
```

#### 3. ุชูุนูู/ุชุนุทูู ุจูุงูููุณุช
```
PUT /api/playlists/{playlist_id}/toggle
```

**ุงูุฑุฏ:**
```json
{
  "success": true,
  "message": "ุชู ุชูุนูู ุงูุจูุงูููุณุช",
  "data": {
    "id": 1,
    "is_active": true
  }
}
```

#### 4. ุญุฐู ุจูุงูููุณุช
```
DELETE /api/playlists/{playlist_id}
```

**ุงูุฑุฏ:**
```json
{
  "success": true,
  "message": "ุชู ุญุฐู ุงูุจูุงูููุณุช ุจูุฌุงุญ"
}
```

### ููููุฒุน (Reseller)

#### 1. ุฌูุจ ุงูุจูุงูููุณุชุฑุงุช ุงูููุตู ุจูุง
```
GET /api/reseller-playlists
```

#### 2. ุฅุถุงูุฉ ุจูุงูููุณุช ููุตู ุจู
```
POST /api/reseller-playlists
Content-Type: application/json

{
  "user_id": 123,
  "device_id": 456,  // ุงุฎุชูุงุฑู
  "media_link": "https://..."
}
```

ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ `device_id`: ุชูุทุจู ุนูู **ุฌููุน ุฃุฌูุฒุฉ ุงููุณุชุฎุฏู**.

#### 3. ุญุฐู ุจูุงูููุณุช ููุตู ุจู
```
DELETE /api/reseller-playlists/{playlist_id}
```

---

## ๐ฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุจูุงูููุณุชุฑุงุช
**ุงููุณุงุฑ:** `/playlist`

**ุงูููุฒุงุช:**
- โ ุนุฑุถ ุฌููุน ุงูุจูุงูููุณุชุฑุงุช ูู ุดูู ุจุทุงูุงุช
- โ ุฒุฑ ุชูุนูู/ุชุนุทูู ููู ุจูุงูููุณุช
- โ ุนุฑุถ ุงูุชูุงุตูู (ูุณุฎ ุงูุฑุงุจุท)
- โ ุญุฐู ุงูุจูุงูููุณุช
- โ ุฅุถุงูุฉ ุจูุงูููุณุช ุฌุฏูุฏ (Modal)
- โ ุดุงุดุฉ ูุงุฑุบุฉ (Empty State) ุนูุฏ ุนุฏู ูุฌูุฏ ุจูุงูููุณุชุฑุงุช

---

## ๐ API: Device Login (ุงูููุญุฏุซ)

### ุงูุทูุจ:
```
POST /api/device/login
Content-Type: application/json

{
  "device_id": "DEV-XXXXX"
}
```

### ุงูุฑุฏ (ุงูููุญุณูู):
```json
{
  "success": true,
  "message": "Device login successful",
  "data": {
    "token": "...",
    "user_id": 1,
    "username": "user123",
    "device_id": "DEV-XXXXX",
    "media_link": "...",  // ููุชูุงูููุฉ ูุน ุงูุฃุฌูุฒุฉ ุงููุฏููุฉ
    "playlists": [  // ๐ ุงูุฌุฏูุฏ
      {
        "id": 1,
        "name": "Premium IPTV",
        "media_link": "https://...",
        "is_active": true,
        "is_reseller_playlist": false,
        "created_at": "2025-12-23T12:00:00"
      },
      {
        "id": 2,
        "name": "Reseller Recommended",
        "media_link": "https://...",
        "is_active": true,
        "is_reseller_playlist": true,
        "created_at": "2025-12-23T13:00:00"
      }
    ],
    "subscription": { ... },
    "device_info": { ... }
  }
}
```

---

## ๐ง ุณูุฑูุจุช ุงูุชุฑุญูู

### ุชุดุบูู ุงูุชุฑุญูู
```bash
python migrate_to_user_playlists.py
```

**ูุงุฐุง ููุนูุ**
1. ูุฌูุจ ุฌููุน ุงูุฃุฌูุฒุฉ ุงูุชู ุชุญุชูู ุนูู `media_link`
2. ููุดุฆ ุจูุงูููุณุช ุฌุฏูุฏ ููู ุฌูุงุฒ
3. ูุญุชูุธ ุจุงูุฑุงุจุท ุงูุฃุตูู ูู ุงูุฌุฏูู ุงูุฌุฏูุฏ
4. ููุนูู ุงูุจูุงูููุณุช ุชููุงุฆูุงู

### ูุซุงู ุนูู ุงูุฅุฎุฑุงุฌ:
```
================================================================================
๐ ุจุฏุก ุนูููุฉ ุงูุชุฑุญูู ูู media_link ุฅูู user_playlists
================================================================================

๐ ุนุฏุฏ ุงูุฃุฌูุฒุฉ ูุน media_link: 15

โ ุชู ุฅูุดุงุก ุจูุงูููุณุช: user123 (DEV-12345)
โ ุชู ุฅูุดุงุก ุจูุงูููุณุช: user456 (DEV-67890)
...
โญ๏ธ  ุจูุงูููุณุช ููุฌูุฏ ุจุงููุนู: DEV-99999

================================================================================
๐ ููุฎุต ุงูุชุฑุญูู
================================================================================
โ ุงูุจูุงูููุณุชุฑุงุช ุงููููุดุฃุฉ: 14
โญ๏ธ  ุงูุจูุงูููุณุชุฑุงุช ุงููุชุฎุทุงุฉ: 1
โ ุงูุฃุฎุทุงุก: 0

================================================================================
โ ุงูุชููุช ุนูููุฉ ุงูุชุฑุญูู ุจูุฌุงุญ!
================================================================================
```

---

## ๐ ุงูุฃูุงู ูุงูุชุญูู

### ุงูุชุญูู ูู ุงูููููุฉ:
- ูู ุจูุงูููุณุช ูุฌุจ ุฃู ูุชุนูู ุจูุณุชุฎุฏู ููุฌูุฏ
- ุงููุณุชุฎุฏู ูุง ูุณุชุทูุน ุงููุตูู ูุจูุงูููุณุชุฑุงุช ูุณุชุฎุฏููู ุขุฎุฑูู
- ุงูููุฒุน ูุง ูุณุชุทูุน ุญุฐู ุจูุงูููุณุชุฑุงุช ูู ูุณุชุฎุฏููู ุขุฎุฑูู

### ุงูุชุญูู ูู ุงูุญุงูุฉ:
- ููุท ุงูุจูุงูููุณุชุฑุงุช ุงููุนุงูุฉ (`is_active=True`) ุชูุฑุฌุน ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- ุงููุณุชุฎุฏู ูุณุชุทูุน ุชุนุทูู/ุชูุนูู ุฃู ุจูุงูููุณุช ูู ูููู

---

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุงููุณุชุฎุฏู ูุถูู ุจูุงูููุณุช ุฌุฏูุฏ
```javascript
// ูู ุงููุฑููุชูุฏ
fetch('/api/playlists', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'My Premium IPTV',
    media_link: 'https://api.iptv.com/playlist?token=xxx'
  })
})
.then(r => r.json())
.then(data => {
  if (data.success) {
    console.log('โ ุชู ุฅุถุงูุฉ ุงูุจูุงูููุณุช');
  }
});
```

### ูุซุงู 2: ุงูุฌูุงุฒ ูุญุตู ุนูู ุงูุจูุงูููุณุชุฑุงุช ุนูุฏ ุงูุฏุฎูู
```javascript
fetch('/api/device/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    device_id: 'DEV-12345'
  })
})
.then(r => r.json())
.then(data => {
  const playlists = data.data.playlists; // ๐
  
  playlists.forEach(p => {
    if (p.is_active) {
      console.log(`โถ๏ธ ูููู ุชุดุบูู: ${p.name}`);
    }
  });
});
```

### ูุซุงู 3: ุงูููุฒุน ูุถูู ุจูุงูููุณุช ููุณุชุฎุฏู
```javascript
// ูู ููุญุฉ ุชุญูู ุงูููุฒุน
fetch('/api/reseller-playlists', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    user_id: 123,
    media_link: 'https://reseller-iptv.com/premium.m3u8'
  })
})
.then(r => r.json())
.then(data => {
  console.log(`โ ุชู ุฅุถุงูุฉ ูู ${data.data.devices_count} ุฌูุงุฒ`);
});
```

---

## ๐ฌ ุงูุชูุงูููุฉ ูุน ูุธุงู ุงูุจุซ ุงููุฏูู

### ุงูุจุซ ูุง ูุฒุงู ูุนูู:
- ุญูู `media_link` ูู ุฌุฏูู `devices` ูุง ูุฒุงู ููุฌูุฏ
- ุนูุฏ device login ููุฑุฌุน ูู ูู `media_link` ู `playlists`
- ุงูุฃุฌูุฒุฉ ุงููุฏููุฉ ุชุณุชุฎุฏู `media_link`
- ุงูุฃุฌูุฒุฉ ุงูุฌุฏูุฏุฉ ุชุณุชุฎุฏู `playlists`

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ ูุง ุงูุฐู ูุฌุจ ูุนูู:
1. ุชุดุบูู ุณูุฑูุจุช ุงูุชุฑุญูู ููุงูุชูุงู ูู ุงูุจูุงูุงุช ุงููุฏููุฉ
2. ุชุญุฏูุซ ุงูุฃุฌูุฒุฉ/ุงูุชุทุจููุงุช ููุนูู ูุน ุงูุจูุงูููุณุชุฑุงุช ุงูุฌุฏูุฏุฉ
3. ุชุนููู ุงูููุฒุนูู ููููุฉ ุงุณุชุฎุฏุงู ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ

### โ๏ธ ููุงุญุธุงุช:
- ุงูุจูุงูููุณุช ุงูููุตู ุจู ูู ุงูููุฒุน ูุญุชูู ุนูู `reseller_playlist` (ููุณ NULL)
- ูููู ูููุณุชุฎุฏู ุชุนุทูู ุจูุงูููุณุช ูู ุงูููุฒุน ููู ูุง ุญุฐูู (ุฅุฐุง ุฃุฑุฏุช ุงูุณูุงุญ ุจุฐูู)
- ุนูุฏ ุญุฐู ูุณุชุฎุฏู: ุฌููุน ุจูุงูููุณุชุฑุงุช ุงููุณุชุฎุฏู ุชูุญุฐู (cascade)

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### "ุงูุจูุงูููุณุช ุบูุฑ ููุฌูุฏ"
- ุชุญูู ูู ุฃู ูุนุฑู ุงูุจูุงูููุณุช ุตุญูุญ
- ุชุญูู ูู ููููุฉ ุงูุจูุงูููุณุช ูููุณุชุฎุฏู ุงูุญุงูู

### "ูุดู ุชุญููู ุงูุจูุงูููุณุชุฑุงุช"
- ุชุฃูุฏ ูู ุงุชุตุงู ุงูุฌูุณุฉ (session['device_uid'])
- ุชุญูู ูู ุงูุฃุฎุทุงุก ูู ูุญุฏุฉ ุงูุชุญูู (Console)

### ุงูุชุฑุญูู ูู ูุนูู
```bash
# ุชุญูู ูู ุฎุทุฃ ูุญุฏุฏ
python migrate_to_user_playlists.py

# ุฅุฑุฌุงุน ุงูุชุฑุญูู (ุฅุฐุง ูุฒู ุงูุฃูุฑ)
python migrate_to_user_playlists.py --rollback
```

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ูููุฒูุฏ ูู ุงููุนูููุงุชุ ุฑุงุฌุน:
- `models.py`: ุชุนุฑูู ุงูุฌุฏูู ูุงูุนูุงูุงุช
- `routes/users.py`: API endpoints ูููุณุชุฎุฏู
- `routes/reseller.py`: API endpoints ููููุฒุน
- `templates/user/playlist.html`: ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-12-23
**ุงูุฅุตุฏุงุฑ:** 2.0.0 - ูุธุงู ุงูุจูุงูููุณุชุฑุงุช ุงููุชุนุฏุฏุฉ
