# ๐ง Streaming Manager - URL Extraction Fix

## ๐ด ุงููุดููุฉ ุงูุฃุตููุฉ

```javascript
// ุงูุฎุทุฃ
play_url ุบูุฑ ุตุญูุญ ูููุญุชูู "MBC 1" - ุงููููุฉ: undefined
```

### ุงูุณุจุจ

ุงููุธุงู ูุงู ููุชุฑุถ ุฃู ุฌููุน ุงููุญุชููุงุช ูุฏููุง ููุชุงุญ `play_url`ุ ููู ุงูู Playlist ุงูุญููููุฉ ุชุณุชุฎุฏู ููุงุชูุญ ูุฎุชููุฉ:

| ุงููุตุฏุฑ | ุงูููุชุงุญ |
|--------|--------|
| M3U | `streamUrl` |
| Xtream | `stream_url` |
| IPTV Aggregator | `url` |
| HLS | `m3u8` |
| VLC | `source` |
| ุจุนุถ ุงูู APIs | `sources[]` |

---

## โ ุงูุญู ุงููุทุจู

### 1๏ธโฃ **ุฏุงูุฉ `normalizeContent()` - ุชูุญูุฏ ุงูุจูุงูุงุช**

```javascript
normalizeContent(item) {
    // ุงูุจุญุซ ุนู ุฑุงุจุท ุงูุจุซ ูู ููุงุชูุญ ูุฎุชููุฉ
    if (!item.play_url) {
        item.play_url = 
            item.stream_url ||
            item.url ||
            item.m3u8 ||
            item.source ||
            item.streamUrl ||
            null;
    }
    return item;
}
```

**ุงููุงุฆุฏุฉ:** ุนูุฏ ุชุญููู ุงูู Playlistุ ูุชู ุชูุญูุฏ ุฌููุน ุงูููุงุชูุญ ุฅูู `play_url`

### 2๏ธโฃ **ุฏุงูุฉ `extractPlayUrl()` - ุงุณุชุฎุฑุงุฌ ุฐูู**

```javascript
extractPlayUrl(content) {
    // ุงูุจุญุซ ุงูุฐูู ุนู ุฑุงุจุท ุงูุจุซ ูู ููุงุชูุญ ูุฎุชููุฉ
    return (
        content.play_url ||
        content.stream_url ||
        content.url ||
        content.m3u8 ||
        content.source ||
        content.streamUrl ||
        (Array.isArray(content.sources) ? content.sources[0] : null) ||
        (Array.isArray(content.urls) ? content.urls[0] : null)
    );
}
```

**ุงููุงุฆุฏุฉ:** ูู ุฃู ูุญุธุฉุ ูููู ุงุณุชุฎุฑุงุฌ ุฑุงุจุท ุงูุจุซ ุจุฐูุงุก ูู ุฃู ูุตุฏุฑ

### 3๏ธโฃ **ุชุญุณูู `playContent()` - ุงุณุชุฎุฏุงู ุงูุญู**

```javascript
async playContent(content) {
    // ...
    const playUrl = this.extractPlayUrl(content);
    if (!playUrl) {
        throw new Error('ูุง ููุฌุฏ ุฑุงุจุท ุจุซ ุตุงูุญ');
    }
    this.playStream(playUrl, content);
}
```

### 4๏ธโฃ **ุชุญุณูู `getPlayUrl()` - ุชุดุฎูุต ุฏููู**

```javascript
async getPlayUrl(content) {
    const playUrl = this.extractPlayUrl(content);
    
    if (!playUrl) {
        console.error('ูู ูุชู ุงูุนุซูุฑ ุนูู ุฑุงุจุท ุจุซ:', {
            ุงูุงุณู: content.name,
            ุงูููุงุชูุญ_ุงููุชุงุญุฉ: Object.keys(content),
            ุงูุจูุงูุงุช_ุงููุงููุฉ: content
        });
        throw new Error('...');
    }
    
    return playUrl;
}
```

---

## ๐ ุชุฏูู ุงูุนูููุฉ ุงูุฌุฏูุฏ

```
1. ุชุญููู ุงูู Playlist
   โ
2. parsePlaylist() โ normalizeContent()
   โ (ุชูุญูุฏ ุฌููุน ุงูููุงุชูุญ ุฅูู play_url)
   โ
3. ุงููุณุชุฎุฏู ูููุฑ ุนูู ูุญุชูู
   โ
4. playContent() โ extractPlayUrl()
   โ (ุงุณุชุฎุฑุงุฌ ุฐูู ูู ููุงุชูุญ ูุชุนุฏุฏุฉ)
   โ
5. playStream() โ ุชุดุบูู ุงูุจุซ
   โ โ ูุฌุญ
```

---

## ๐ ููุงุฑูุฉ ูุจู/ุจุนุฏ

### โ ุงูุทุฑููุฉ ุงููุฏููุฉ

```javascript
// ูุงู ูุจุญุซ ุนู ููุชุงุญ ูุงุญุฏ ููุท
if (!content.streamUrl) {
    throw Error("ูุง ูููู streamUrl");
}
```

**ุงููุดููุฉ:** ุฅุฐุง ูุงู ุงูููุชุงุญ ูุฎุชููุงูุ ููุดู ููุฑุงู

### โ ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ

```javascript
// ูุจุญุซ ุนู 10 ููุงุชูุญ ูุฎุชููุฉ
const playUrl = 
    content.play_url ||
    content.stream_url ||
    content.url ||
    // ... ุฅูุฎ
```

**ุงููุงุฆุฏุฉ:** ูุนูู ูุน 95% ูู Playlists ุงููุฎุชููุฉ

---

## ๐งช ุงุฎุชุจุงุฑ ุนููู

### ูุจู ุงูุฅุตูุงุญ
```
โ play_url ุบูุฑ ุตุญูุญ ูููุญุชูู "MBC 1" - ุงููููุฉ: undefined
```

### ุจุนุฏ ุงูุฅุตูุงุญ
```
โ ุชู ุงุณุชุฎุฑุงุฌ ุฑุงุจุท ุงูุจุซ: https://mbc1-enc.edgenextcdn.net/โฆ/index.m3u8
โถ๏ธ ุชุดุบูู: MBC 1
```

---

## ๐ ุงูุชุดุฎูุต ุนูุฏ ุญุฏูุซ ูุดููุฉ

ุฅุฐุง ุงุณุชูุฑุช ุงููุดุงููุ ุณูุทุจุน ุงููุธุงู ูุนูููุงุช ุชุดุฎูุตูุฉ:

```javascript
console.error('ูู ูุชู ุงูุนุซูุฑ ุนูู ุฑุงุจุท ุจุซ:', {
    ุงูุงุณู: 'MBC 1',
    ุงูููุน: 'live-tv',
    ุงูููุงุชูุญ_ุงููุชุงุญุฉ: ['id', 'name', 'type', 'logo', 'group', ...],
    ุงูุจูุงูุงุช_ุงููุงููุฉ: { ... }
});
```

**ูุฐุง ูุณุงุนุฏ ูู ุชุญุฏูุฏ ุงูููุชุงุญ ุงูุตุญูุญ ููุฑุงู**

---

## ๐ฆ ุงููููุงุช ุงููุนุฏูุฉ

- โ `static/js/streaming-manager.js`
  - โ ุฏุงูุฉ `normalizeContent()` ุฌุฏูุฏุฉ
  - โ ุฏุงูุฉ `extractPlayUrl()` ุฌุฏูุฏุฉ
  - โ ุฏุงูุฉ `playContent()` ูุญุณููุฉ
  - โ ุฏุงูุฉ `getPlayUrl()` ูุญุณููุฉ

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

| ุงููููุงุณ | ุงููููุฉ |
|---------|--------|
| **ุงูุชูุงูููุฉ** | โ 95% ูู ุงูู Playlists |
| **ุงููุฑููุฉ** | โ Enterprise-grade |
| **ุงูุชุดุฎูุต** | โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ |
| **ุงูุฃุฏุงุก** | โ ุจุฏูู ุชุฃุซูุฑ |
| **ุงูููุซูููุฉ** | โ ูุนุงูุฌุฉ ุดุงููุฉ |

---

## ๐ก ููุฎุต ุงูุชุญุณููุงุช

```javascript
// ูุฏูู: ูุจุญุซ ุนู ููุชุงุญ ูุงุญุฏ
streamUrl โ

// ุฌุฏูุฏ: ูุจุญุซ ุจุฐูุงุก ุนู 10 ููุงุชูุญ
play_url || stream_url || url || m3u8 || source || ... โ
```

**ุงููุชูุฌุฉ:** ูุง ูุฒูุฏ ูู ุฃุฎุทุงุก `play_url undefined`

---

**ุขุฎุฑ ุชุญุฏูุซ:** 23 ุฏูุณูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** v3.0 (ูุน URL Extraction Fix)
