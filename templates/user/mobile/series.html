<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Servo - Series</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../static/css/user/mobile/series.css">
    <link rel="stylesheet" href="../../static/css/user/mobile/components/bottom-nav.css">
</head>
<body>
    <header class="mobile-header">
        <h1 class="greeting-name">Series</h1>
        <div class="search-container">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon">
                <path d="m21 21-4.34-4.34"></path>
                <circle cx="11" cy="11" r="8"></circle>
            </svg>
            <input type="text" id="searchInput" class="search-input" placeholder="Search series...">
        </div>
    </header>

    <main class="mobile-main">
        <!-- LIST VIEW: Series Grid -->
        <div id="seriesListView">
            <!-- Category Filter -->
            <div class="category-filter">
                <button class="category-btn active" data-category="all">All</button>
            </div>

            <div class="series-grid" id="seriesGrid">
                <!-- Series cards will be generated by JavaScript -->
            </div>

            <div class="no-results" id="noResults" style="display: none;">
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 64px; margin-bottom: 20px; opacity: 0.5;">ğŸ“º</div>
                    <h2 style="font-size: 20px; margin: 0 0 10px 0; color: #fff;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ù„Ø³Ù„Ø§Øª</h2>
                    <p style="font-size: 14px; color: #aaa; margin: 0;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³Ù„Ø³Ù„Ø§Øª</p>
                </div>
            </div>
        </div>

        <!-- DETAILS VIEW: Series Episodes/Details -->
        <div id="seriesDetailsView" style="display: none;">
            <!-- Back Button + Series Header -->
            <div class="series-details-header">
                <button id="backBtn" class="back-btn" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m15 18-6-6 6-6"></path>
                    </svg>
                </button>
                <div id="seriesTitle" class="series-title">Series Title</div>
            </div>

            <!-- Series Cover and Info -->
            <div id="seriesInfo" class="series-info-container">
                <!-- Filled by JavaScript -->
            </div>

            <!-- Series Details Tabs -->
            <div class="series-tabs">
                <button class="tab-btn active" data-tab="episodes">Ø§Ù„Ø­Ù„Ù‚Ø§Øª</button>
                <button class="tab-btn" data-tab="description">Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                <button class="tab-btn" data-tab="similar">Ù…Ø´Ø§Ø¨Ù‡Ø©</button>
            </div>

            <!-- Episodes/Items List (Tab 1) -->
            <div id="episodesTab" class="tab-content active">
                <div id="episodesList" class="episodes-list">
                    <!-- Episodes will be generated by JavaScript -->
                </div>

                <div class="no-episodes" id="noEpisodes" style="display: none;">
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 64px; margin-bottom: 20px; opacity: 0.5;">ğŸ¬</div>
                        <h2 style="font-size: 20px; margin: 0 0 10px 0; color: #fff;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù„Ù‚Ø§Øª</h2>
                        <p style="font-size: 14px; color: #aaa; margin: 0;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù„Ù‚Ø§Øª Ù„Ù„Ø³Ù„Ø³Ù„Ø©</p>
                    </div>
                </div>
            </div>

            <!-- Description Tab (Tab 2) -->
            <div id="descriptionTab" class="tab-content" style="display: none;">
                <div class="description-container">
                    <!-- Description -->
                    <div class="info-section">
                        <h3 class="section-title">ğŸ“ Ø§Ù„ÙˆØµÙ</h3>
                        <p id="seriesDescription" class="section-content description-text">
                            Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­
                        </p>
                    </div>

                    <!-- Ratings -->
                    <div class="info-section">
                        <h3 class="section-title">â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h3>
                        <div id="seriesRating" class="rating-container">
                            <div class="rating-badge">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
                        </div>
                    </div>

                    <!-- Cast -->
                    <div class="info-section">
                        <h3 class="section-title">ğŸ­ Ø§Ù„Ù…Ù…Ø«Ù„ÙˆÙ†</h3>
                        <div id="seriesCast" class="cast-container">
                            <!-- Cast members will be generated here -->
                        </div>
                    </div>

                    <!-- Metadata -->
                    <div class="info-section">
                        <h3 class="section-title">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h3>
                        <div id="seriesMetadata" class="metadata-container">
                            <!-- Metadata will be generated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Similar Series Tab (Tab 3) -->
            <div id="similarTab" class="tab-content" style="display: none;">
                <div id="similarSeriesList" class="similar-series-grid">
                    <!-- Similar series will be generated here -->
                </div>
                <div class="no-similar" id="noSimilar" style="display: none;">
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 64px; margin-bottom: 20px; opacity: 0.5;">ğŸ”</div>
                        <h2 style="font-size: 20px; margin: 0 0 10px 0; color: #fff;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ù„Ø³Ù„Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©</h2>
                        <p style="font-size: 14px; color: #aaa; margin: 0;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³Ù„Ø³Ù„Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-spacer"></div>
    </main>

    <!-- Video Player Modal -->
    <div id="videoPlayerModal" class="video-player-modal" style="display: none;">
        <div class="video-player-container">
            <button id="closeVideoBtn" class="close-video-btn" type="button">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <video id="video-player" 
                   class="hls-video-player"
                   controls 
                   autoplay 
                   width="100%" 
                   height="auto"
                   playsinline
                   crossorigin="anonymous">
                Your browser does not support the video tag.
            </video>
            <div id="videoPlayerInfo" class="video-player-info">
                <h2 id="videoTitle">Loading...</h2>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAVIGATION COMPONENT -->
    {% include 'user/mobile/components/bottom-nav.html' %}

    <!-- HLS.js for streaming support (Chrome, Firefox, etc) -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest/dist/hls.min.js"></script>

    <!-- Streaming Manager -->
    <script src="../../static/js/streaming-manager.js"></script>
    
    <!-- App Manager for error handling -->
    <script src="../../static/js/app-manager.js"></script>

    <script>
        class MobileSeriesApp {
            constructor() {
                this.allSeries = [];
                this.filteredSeries = [];
                this.currentCategory = 'all';
                this.searchQuery = '';
                this.streamingManager = null;
                this.isInitialized = false;

                // Current series details
                this.currentSeries = null;
                this.currentSeriesItems = [];

                // Views
                this.seriesListView = document.getElementById('seriesListView');
                this.seriesDetailsView = document.getElementById('seriesDetailsView');
                
                // List view elements
                this.seriesGrid = document.getElementById('seriesGrid');
                this.searchInput = document.getElementById('searchInput');
                this.noResults = document.getElementById('noResults');

                // Details view elements
                this.backBtn = document.getElementById('backBtn');
                this.seriesTitleEl = document.getElementById('seriesTitle');
                this.seriesInfoEl = document.getElementById('seriesInfo');
                this.episodesListEl = document.getElementById('episodesList');
                this.noEpisodesEl = document.getElementById('noEpisodes');

                this.setupEventListeners();
                this.init();
            }

            async init() {
                console.log('ğŸ¬ Loading series...');
                try {
                    // Initialize streaming manager
                    if (typeof StreamingManager === 'undefined') {
                        throw new Error('StreamingManager not loaded');
                    }

                    this.streamingManager = new StreamingManager();
                    await this.streamingManager.init();

                    // Get series from IPTV content
                    this.allSeries = this.streamingManager.getContentByType('series');
                    this.filteredSeries = [...this.allSeries];

                    console.log(`âœ… Loaded ${this.allSeries.length} series`);

                    // Render immediately
                    this.render();
                    this.isInitialized = true;

                } catch (error) {
                    console.error('âŒ Error loading series:', error);
                    this.showError('Failed to load series');
                }
            }

            render() {
                this.renderCategories();
                this.renderSeries();
            }

            renderCategories() {
                const filterContainer = document.querySelector('.category-filter');
                if (!filterContainer) return;

                const categories = this.getUniqueCategories();

                let html = `
                    <button class="category-btn ${this.currentCategory === 'all' ? 'active' : ''}" data-category="all">
                        All (${this.allSeries.length})
                    </button>
                `;

                categories.forEach(category => {
                    const count = this.getSeriesByCategory(category).length;
                    html += `
                        <button class="category-btn ${this.currentCategory === category ? 'active' : ''}" data-category="${category}">
                            ${category} (${count})
                        </button>
                    `;
                });

                filterContainer.innerHTML = html;

                // Re-attach event listeners after re-rendering
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.handleCategoryChange(e));
                });
            }

            renderSeries() {
                if (!this.seriesGrid) return;

                this.seriesGrid.innerHTML = '';

                if (this.filteredSeries.length === 0) {
                    this.noResults.style.display = 'block';
                    return;
                }

                this.noResults.style.display = 'none';

                // Use fragment for better performance
                const fragment = document.createDocumentFragment();
                
                this.filteredSeries.forEach((series, index) => {
                    const card = this.createSeriesCard(series, index);
                    fragment.appendChild(card);
                });
                
                this.seriesGrid.appendChild(fragment);
            }

            createSeriesCard(series, index) {
                const card = document.createElement('button');
                card.className = 'series-card';
                card.dataset.seriesId = series.id;
                card.type = 'button';

                const title = (series.name || 'Series').substring(0, 20);
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ù…Ø­Ù„ÙŠØ© Ø£Ùˆ Ø®Ø¯Ù…Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† via.placeholder.com
                let poster = series.logo;
                if (!poster || poster.includes('imgur.com')) {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø¯Ù…Ø© placehold.co Ø¨Ø¯Ù„ via.placeholder.com (Ù…ØªØ§Ø­Ø© ÙÙŠ Ù…ØµØ± ÙˆØ§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·)
                    poster = `https://placehold.co/300x450/1a1a2e/ffffff?text=${encodeURIComponent(title)}`;
                }

                // âœ… Ø§Ù„Ø­Ù„ Ø±Ù‚Ù… (3): Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                let overlayIcon = this.getOverlayIcon(series.type);
                let typeLabel = this.getTypeLabel(series.type);

                card.innerHTML = `
                    <div class="card-img-container">
                        <img src="${poster}" alt="${title}" class="card-img" loading="lazy" onerror="this.src='https://placehold.co/300x450/1a1a2e/ffffff?text=${encodeURIComponent(title)}'">
                        <div class="play-overlay">
                            ${overlayIcon}
                        </div>
                    </div>
                    <div class="card-info">
                        <div class="card-title">${title}</div>
                        <div class="card-type-badge">${typeLabel}</div>
                        <div class="card-category">${series.group || 'Series'}</div>
                    </div>
                `;

                // ğŸ¯ ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                card.addEventListener('click', () => this.openSeriesDetails(series));
                return card;
            }

            /**
             * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
             */
            getOverlayIcon(contentType) {
                switch(contentType) {
                    case 'series':
                        // ğŸ“‚ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø¬Ù„Ø¯ Ù„Ù„Ø³Ù„Ø³Ù„Ø§Øª
                        return `<svg class="overlay-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                            <path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"></path>
                        </svg><span class="overlay-text">Ø³Ù„Ø³Ù„Ø©</span>`;
                    
                    case 'movies':
                        // ğŸ¬ Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙŠÙ„Ù…
                        return `<svg class="overlay-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54h3.98l4.84-6.32c.25-.33.01-.81-.35-.81H6.21c-.36 0-.6.48-.34.81l4.09 5.38z"></path>
                        </svg><span class="overlay-text">ÙÙŠÙ„Ù…</span>`;
                    
                    case 'live-tv':
                    default:
                        // â–¶ï¸ Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ´ØºÙŠÙ„ Ù„Ù„Ù‚Ù†ÙˆØ§Øª ÙˆØ§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                        return `<svg class="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                            <path d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"></path>
                        </svg><span class="overlay-text">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</span>`;
                }
            }

            /**
             * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
             */
            getTypeLabel(contentType) {
                switch(contentType) {
                    case 'series':
                        return 'ğŸ“‚ Ø³Ù„Ø³Ù„Ø©';
                    case 'movies':
                        return 'ğŸ¬ ÙÙŠÙ„Ù…';
                    case 'live-tv':
                    default:
                        return 'ğŸ“º Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±';
                }
            }

            playSeries(series) {
                console.log('ğŸ¬ Playing series:', series.name);
                if (this.streamingManager) {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… playContent Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† playStream Ù…Ø¨Ø§Ø´Ø±Ø©
                    this.streamingManager.playContent(series);
                } else {
                    this.showError('Streaming Manager not initialized');
                }
            }

            /**
             * ğŸ¯ ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù„Ø³Ù„Ø©
             */
            openSeriesDetails(series) {
                console.log('ğŸ“‚ ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù„Ø³Ù„Ø©:', series.name);
                
                this.currentSeries = series;
                this.seriesTitleEl.textContent = series.name;

                // Ø¥Ù†Ø´Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ù„Ø³Ù„Ø©
                this.renderSeriesInfoHeader();
                
                // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø­Ù„Ù‚Ø§Øª
                this.loadSeriesItems();

                // Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                this.renderSeriesDetails();

                // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
                this.seriesListView.style.display = 'none';
                this.seriesDetailsView.style.display = 'block';
            }

            /**
             * Ø¹Ø±Ø¶ Ø±Ø£Ø³ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ù„Ø³Ù„Ø©
             */
            renderSeriesInfoHeader() {
                const series = this.currentSeries;
                
                let poster = series.logo;
                if (!poster || poster.includes('imgur.com')) {
                    const title = (series.name || 'Series').substring(0, 20);
                    poster = `https://placehold.co/300x450/1a1a2e/ffffff?text=${encodeURIComponent(title)}`;
                }

                this.seriesInfoEl.innerHTML = `
                    <div class="series-info-content">
                        <img src="${poster}" alt="${series.name}" class="series-poster" 
                             onerror="this.src='https://placehold.co/300x450/1a1a2e/ffffff?text=${encodeURIComponent(series.name)}'">
                        <div class="series-info-text">
                            <h2 class="series-name">${series.name}</h2>
                            <p class="series-group">${series.group || 'Series'}</p>
                            <p class="series-type">
                                <span class="type-badge">ğŸ“‚ Ø§Ù„Ø³Ù„Ø³Ù„Ø©</span>
                            </p>
                        </div>
                    </div>
                `;
            }

            /**
             * Ø¬Ù„Ø¨ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø³Ù„Ø³Ù„Ø© (Ø§Ù„Ø­Ù„Ù‚Ø§Øª/Ø§Ù„Ù‚Ù†ÙˆØ§Øª/Ø§Ù„Ø£Ù‚Ø³Ø§Ù…)
             */
            loadSeriesItems() {
                try {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù„Ø³Ù„Ø©
                    // Ù‚Ø¯ ØªÙƒÙˆÙ† ÙÙŠ: items, children, episodes, streams
                    const series = this.currentSeries;
                    
                    let items = [];
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø·Ø±Ù‚ Ù…Ø®ØªÙ„ÙØ©
                    if (series.items && Array.isArray(series.items)) {
                        items = series.items;
                    } else if (series.children && Array.isArray(series.children)) {
                        items = series.children;
                    } else if (series.episodes && Array.isArray(series.episodes)) {
                        items = series.episodes;
                    }

                    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø¹Ù†Ø§ØµØ± ØµØ±ÙŠØ­Ø©ØŒ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†Ø§ØµØ± Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù†ÙØ³ Ø§Ù„ÙØ¦Ø©
                    if (items.length === 0) {
                        console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†Ø§ØµØ± Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù†ÙØ³ Ø§Ù„ÙØ¦Ø©...');
                        items = this.findRelatedItems(series);
                    }

                    if (items.length === 0) {
                        console.warn('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù„Ù‚Ø§Øª/Ø¹Ù†Ø§ØµØ± Ù„Ù„Ø³Ù„Ø³Ù„Ø©');
                        this.episodesListEl.innerHTML = '';
                        this.noEpisodesEl.style.display = 'block';
                        return;
                    }

                    this.currentSeriesItems = items;
                    this.renderEpisodesList(items);
                    this.noEpisodesEl.style.display = 'none';

                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø­Ù„Ù‚Ø§Øª:', error);
                    this.showError('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø§Øª');
                }
            }

            /**
             * Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†Ø§ØµØ± Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ù…Ù† Ù†ÙØ³ Ø§Ù„ÙØ¦Ø©
             */
            findRelatedItems(series) {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­ØªÙˆÙ‰ Ø¢Ø®Ø± Ù…Ù† Ù†ÙØ³ Ø§Ù„ÙØ¦Ø©
                return this.streamingManager.contentList.filter(item => {
                    // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    if (item.id === series.id) return false;

                    // Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ù†ÙØ³ Ø§Ù„ÙØ¦Ø©
                    // ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø­Ù„Ù‚Ø§Øª Ø£Ùˆ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ´ØºÙŠÙ„
                    return item.group === series.group && 
                           (item.type === 'episode' || item.type === 'live-tv' || item.streamUrl);
                });
            }

            /**
             * Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª
             */
            renderEpisodesList(items) {
                this.episodesListEl.innerHTML = '';

                const fragment = document.createDocumentFragment();

                items.forEach((item, index) => {
                    const itemEl = this.createEpisodeItem(item, index);
                    fragment.appendChild(itemEl);
                });

                this.episodesListEl.appendChild(fragment);
            }

            /**
             * Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø­Ù„Ù‚Ø©
             */
            createEpisodeItem(item, index) {
                const itemBtn = document.createElement('button');
                itemBtn.className = 'episode-item';
                itemBtn.type = 'button';

                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ù…Ø² ÙˆØ§Ù„Ù†ÙˆØ¹
                let icon = 'â–¶ï¸';
                let typeLabel = 'Ø­Ù„Ù‚Ø©';
                
                if (item.type === 'live-tv') {
                    icon = 'ğŸ”´';
                    typeLabel = 'Ù…Ø¨Ø§Ø´Ø±';
                } else if (item.type === 'channel') {
                    icon = 'ğŸ“¡';
                    typeLabel = 'Ù‚Ù†Ø§Ø©';
                }

                const title = (item.name || 'Item').substring(0, 50);

                itemBtn.innerHTML = `
                    <div class="episode-item-content">
                        <div class="episode-icon">${icon}</div>
                        <div class="episode-info">
                            <div class="episode-title">${title}</div>
                            <div class="episode-type">${typeLabel}</div>
                        </div>
                    </div>
                    <svg class="episode-arrow" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m9 18 6-6-6-6"></path>
                    </svg>
                `;

                itemBtn.addEventListener('click', () => this.playItem(item));
                return itemBtn;
            }

            /**
             * ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø©/Ø§Ù„Ø¹Ù†ØµØ±
             */
            playItem(item) {
                console.log('â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø¹Ù†ØµØ±:', item.name);

                // ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù†ØµØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø¨Ø«
                if (!item.streamUrl) {
                    console.warn('âš ï¸ Ø§Ù„Ø¹Ù†ØµØ± Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø¨Ø«:', item);
                    this.showError(`âŒ "${item.name}" Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø¨Ø«`);
                    return;
                }

                // Ø§Ø³ØªØ®Ø¯Ù… streaming manager Ù„Ù„ØªØ´ØºÙŠÙ„
                if (this.streamingManager) {
                    this.streamingManager.playContent(item);
                } else {
                    this.showError('Streaming Manager not initialized');
                }
            }

            /**
             * ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ù…Ù…Ø«Ù„ÙŠÙ† ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
             */
            renderSeriesDetails() {
                const series = this.currentSeries;
                
                // Ø§Ù„ÙˆØµÙ
                const descriptionEl = document.getElementById('seriesDescription');
                if (descriptionEl) {
                    const description = series.description || series.summary || series.plot || 
                                      `${series.name} - Ù…Ø³Ù„Ø³Ù„ Ù…Ù† ÙØ¦Ø© ${series.group}`;
                    descriptionEl.textContent = description;
                }

                // Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                this.renderRatings();

                // Ø§Ù„Ù…Ù…Ø«Ù„ÙˆÙ†
                this.renderCast();

                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                this.renderMetadata();

                // Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø©
                this.renderSimilarSeries();

                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
                this.setupTabs();
            }

            /**
             * â­ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
             */
            renderRatings() {
                const series = this.currentSeries;
                const ratingEl = document.getElementById('seriesRating');
                if (!ratingEl) return;

                let ratingHTML = '';

                if (series.rating || series.imdb || series.score) {
                    const rating = series.rating || series.imdb || series.score;
                    const stars = this.generateStars(rating);
                    
                    ratingHTML = `
                        <div class="rating-item">
                            <div class="rating-stars">${stars}</div>
                            <div class="rating-value">${rating}/10</div>
                        </div>
                    `;
                } else {
                    ratingHTML = '<div class="rating-badge">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>';
                }

                ratingEl.innerHTML = ratingHTML;
            }

            /**
             * ØªÙˆÙ„ÙŠØ¯ Ù†Ø¬ÙˆÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
             */
            generateStars(rating) {
                const stars = Math.round((rating || 5) / 2);
                let html = '';
                for (let i = 0; i < 5; i++) {
                    html += i < stars ? 'â­' : 'â˜†';
                }
                return html;
            }

            /**
             * ğŸ­ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù…Ø«Ù„ÙŠÙ†
             */
            renderCast() {
                const series = this.currentSeries;
                const castEl = document.getElementById('seriesCast');
                if (!castEl) return;

                let castHTML = '';

                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù…Ø«Ù„ÙŠÙ† Ù…Ù† Ø­Ù‚ÙˆÙ„ Ù…Ø®ØªÙ„ÙØ©
                let castList = series.cast || series.actors || series.starring || [];
                
                if (typeof castList === 'string') {
                    castList = castList.split(',').map(c => c.trim());
                }

                if (castList.length > 0) {
                    castHTML = castList.slice(0, 6).map(actor => `
                        <div class="cast-member">
                            <div class="cast-avatar">ğŸ­</div>
                            <div class="cast-name">${actor}</div>
                        </div>
                    `).join('');
                } else {
                    castHTML = '<div class="cast-badge">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù…Ø«Ù„ÙŠÙ†</div>';
                }

                castEl.innerHTML = castHTML;
            }

            /**
             * â„¹ï¸ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
             */
            renderMetadata() {
                const series = this.currentSeries;
                const metadataEl = document.getElementById('seriesMetadata');
                if (!metadataEl) return;

                let metadataHTML = '';

                // Ø§Ù„ÙØ¦Ø©
                if (series.group) {
                    metadataHTML += `<div class="metadata-item"><span class="metadata-label">Ø§Ù„ÙØ¦Ø©:</span> ${series.group}</div>`;
                }

                // Ø§Ù„Ø³Ù†Ø©
                if (series.year || series.date) {
                    metadataHTML += `<div class="metadata-item"><span class="metadata-label">Ø§Ù„Ø³Ù†Ø©:</span> ${series.year || series.date}</div>`;
                }

                // Ø§Ù„Ù„ØºØ©
                if (series.language) {
                    metadataHTML += `<div class="metadata-item"><span class="metadata-label">Ø§Ù„Ù„ØºØ©:</span> ${series.language}</div>`;
                }

                // Ø§Ù„Ø¯ÙˆÙ„Ø©
                if (series.country) {
                    metadataHTML += `<div class="metadata-item"><span class="metadata-label">Ø§Ù„Ø¯ÙˆÙ„Ø©:</span> ${series.country}</div>`;
                }

                // Ø§Ù„Ù†ÙˆØ¹
                if (series.genre) {
                    metadataHTML += `<div class="metadata-item"><span class="metadata-label">Ø§Ù„Ù†ÙˆØ¹:</span> ${series.genre}</div>`;
                }

                // Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù„Ù‚Ø§Øª
                if (this.currentSeriesItems.length > 0) {
                    metadataHTML += `<div class="metadata-item"><span class="metadata-label">Ø§Ù„Ø­Ù„Ù‚Ø§Øª:</span> ${this.currentSeriesItems.length}</div>`;
                }

                if (!metadataHTML) {
                    metadataHTML = '<div class="metadata-badge">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</div>';
                }

                metadataEl.innerHTML = metadataHTML;
            }

            /**
             * ğŸ” Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø©
             */
            renderSimilarSeries() {
                const similarEl = document.getElementById('similarSeriesList');
                const noSimilarEl = document.getElementById('noSimilar');
                if (!similarEl || !noSimilarEl) return;

                const similarSeries = this.findSimilarSeries();

                if (similarSeries.length === 0) {
                    similarEl.innerHTML = '';
                    noSimilarEl.style.display = 'block';
                    return;
                }

                noSimilarEl.style.display = 'none';

                const fragment = document.createDocumentFragment();
                
                similarSeries.slice(0, 4).forEach(series => {
                    const card = this.createSimilarSeriesCard(series);
                    fragment.appendChild(card);
                });

                similarEl.innerHTML = '';
                similarEl.appendChild(fragment);
            }

            /**
             * Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ù„Ø³Ù„Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©
             */
            findSimilarSeries() {
                const series = this.currentSeries;
                const allSeries = this.allSeries || [];

                return allSeries.filter(s => {
                    // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
                    if (s.id === series.id) return false;

                    // Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ù„Ø³Ù„Ø§Øª Ù…Ù† Ù†ÙØ³ Ø§Ù„ÙØ¦Ø©
                    return s.group === series.group || s.type === 'series';
                }).slice(0, 10);
            }

            /**
             * Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø³Ù„Ø³Ù„ Ù…Ø´Ø§Ø¨Ù‡
             */
            createSimilarSeriesCard(series) {
                const card = document.createElement('button');
                card.className = 'similar-series-card';
                card.type = 'button';

                const title = (series.name || 'Series').substring(0, 15);
                let poster = series.logo;
                if (!poster || poster.includes('imgur.com')) {
                    poster = `https://placehold.co/200x300/1a1a2e/ffffff?text=${encodeURIComponent(title)}`;
                }

                card.innerHTML = `
                    <img src="${poster}" alt="${title}" class="similar-poster" 
                         onerror="this.src='https://placehold.co/200x300/1a1a2e/ffffff?text=${encodeURIComponent(title)}'">
                    <div class="similar-title">${title}</div>
                `;

                card.addEventListener('click', () => this.openSeriesDetails(series));
                return card;
            }

            /**
             * ğŸ“‘ Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
             */
            setupTabs() {
                const tabBtns = document.querySelectorAll('.tab-btn');
                const tabContents = document.querySelectorAll('.tab-content');

                tabBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabName = e.target.dataset.tab;
                        
                        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
                        tabBtns.forEach(b => b.classList.remove('active'));
                        tabContents.forEach(tc => {
                            tc.style.display = 'none';
                            tc.classList.remove('active');
                        });

                        // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø®ØªØ§Ø±
                        e.target.classList.add('active');
                        const selectedTab = document.getElementById(tabName + 'Tab');
                        if (selectedTab) {
                            selectedTab.style.display = 'block';
                            selectedTab.classList.add('active');
                        }
                    });
                });
            }

            /**
             * Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
             */
            goBackToList() {
                console.log('â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©');
                this.currentSeries = null;
                this.currentSeriesItems = [];
                
                this.seriesDetailsView.style.display = 'none';
                this.seriesListView.style.display = 'block';
            }

            handleCategoryChange(e) {
                const category = e.target.dataset.category;
                this.currentCategory = category;
                this.applyFilters();
                this.renderCategories();
            }

            getUniqueCategories() {
                return [...new Set(this.allSeries.map(s => s.group).filter(Boolean))];
            }

            getSeriesByCategory(category) {
                return this.allSeries.filter(s => s.group === category);
            }

            applyFilters() {
                this.filteredSeries = this.allSeries.filter(series => {
                    const matchCategory = this.currentCategory === 'all' || series.group === this.currentCategory;
                    const matchSearch = series.name.toLowerCase().includes(this.searchQuery.toLowerCase());
                    return matchCategory && matchSearch;
                });
                this.renderSeries();
            }

            setupEventListeners() {
                // Category buttons
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.handleCategoryChange(e));
                });

                // Search input
                if (this.searchInput) {
                    let searchTimeout;
                    this.searchInput.addEventListener('input', (e) => {
                        this.searchQuery = e.target.value;
                        
                        // Debounce search for better performance
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            this.applyFilters();
                        }, 300);
                    });
                }

                // Back button in details view
                if (this.backBtn) {
                    this.backBtn.addEventListener('click', () => this.goBackToList());
                }
            }

            showError(message) {
                console.error('âŒ Error:', message);
                const msg = document.createElement('div');
                msg.textContent = message;
                msg.style.cssText = `
                    position: fixed;
                    bottom: 100px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #ef4444;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 14px;
                    z-index: 1000;
                `;
                document.body.appendChild(msg);
                setTimeout(() => msg.remove(), 3000);
            }
        }

        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.mobileSeriesApp = new MobileSeriesApp();
            });
        } else {
            window.mobileSeriesApp = new MobileSeriesApp();
        }
    </script>
</body>
</html>
